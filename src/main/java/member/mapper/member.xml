<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="member">

	<select id="loginCheck" resultType="String">
	select name from users
	where user_id=#{user_id} and passwd=#{passwd}
	</select>
	
	
	<select id="getUserType" resultType="String">
	select user_type from users
	where user_id=#{user_id}
	</select>


	<select id="member_view" resultType="member.dto.MemberDTO">
	select user_id, user_type, name, gender, zipcode, address1, address2, email, tel1, tel2, birthdate
	from users
	where user_id = #{user_id}
	</select>
	
	
	<select id="student_view" resultType="member.dto.StudentDTO">
	select student_id, dept_name, status, grade 
	from students s
	inner join dept d on s.dept_id = d.dept_id
	where user_id=#{user_id}
	</select>
	
	<select id="professor_view" resultType="member.dto.ProfessorDTO">
	select professor_id, dept_name, rank 
	from professors p
	inner join dept d on p.dept_id = d.dept_id;
	where user_id=#{user_id}
	</select>


	<select id="getBorrowedBooks" resultType="circulate.dto.CheckoutDTO">
	select b.title, c.checkout_date, coalesce(c.renewal_date,c.due_date) as due_date, c.renewal_count,
	listagg(a.author_name, ';') within group (order by ba.preference desc, a.author_id) as authornames
	from checkout c
	join books b on c.isbn = b.isbn
	join book_author ba on c.isbn = ba.isbn
	join author a on ba.author_id = a.author_id
	where c.return_date is null and c.user_id = #{user_id} and ba.author_type = '지음'
	group by b.title, c.checkout_date, c.due_date, c.renewal_date, c.renewal_count
	order by checkout_date desc
	</select>


</mapper>